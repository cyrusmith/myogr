- javascript 'packages'
= javascript_tag do
  window.days_off = #{raw @package_form.days_info.to_json}

- if @package_form.new? and not current_user.case?
  #sticky-notification.notice
    С услугой "Кейс" вы сможете забирать товары без очереди даже в те дни, когда лимит записи уже исчерпан!
    = link_to 'Подключить кейс', 'http://ogromno.com/index.php?act=zak&CODE=15'
    %a.icon-remove{:href => '#close'}

- package_list = @package_form.package_list
= form_for @package_form.package do |f|
  = render 'distribution/packages/form/point_control', points: @package_form.points, chosen_point: @package_form.chosen_point
  - unless @package_form.new?
    %h5
      Вы записаны в ЦР на #{@package_form.chosen_point.address.short_address}. Дата получения #{ Russian::strftime package_list.date, '%e %B(%A)'}.
      Номер записи - #{@package_form.code}.
  %p.work-schedule
    = raw @package_form.chosen_point.try(:work_schedule)
  - if @package_form.errors.any?
    - errors = @package_form.errors
    .notice.error
      %i.icon-remove-sign.icon-large
      - if errors.size == 1
        = errors.full_messages.first
      -else
        %ul.no-margin
          - @package_form.errors.full_messages.each do |msg|
            %li= msg

  #calendar{style: ('display:none' if package_list.nil? and @package_form.chosen_point.nil?)}
    #calendar-loading
      %span#krutilka
    = hidden_field_tag :package_date, package_list.nil? ? '' : package_list.date.to_date.iso8601

  %fieldset#package-items
    %legend
      Заказы
      = help_icon 'Список заказов которые Вы хотите получить в Центре раздач. Если заказа нет в списке, Вы можете его добавить, указав ссылку на тему или id темы. Если в списке присутствуют заказы, которые Вы получили, можете его удалить.', :top
    %table.tight
      %thead
        %tr
          %td Id закупки
          %td Название закупки
          %td Организатор
          %td
      %tbody
        - @package_form.shown_items.each do |item|
          - item_id = item.is_a?(Distributor) ? item.id : item.item_id
          %tr{id:item_id}
            %td= item_id
            %td= raw item.title
            %td= item.organizer
            %td{nowrap: 'nowrap'}
              = hidden_field_tag 'tid[]', item_id
              %ul.button-bar
                %li
                  = link_to remove_from_cabinet_path(item_id),
                            title: 'Уже получено(удалить из личного кабинета)', remote:true, confirm: 'Внимание! Все товары из удаляемой закупки будут безвозвратно удалены из вашего личного кабинета!' do
                    %i.icon-trash.icon-large
                %li
                  = link_to '#', class: 'remove_custom_tid', title: 'Отложить(забрать в следующий раз)' do
                    %i.icon-inbox.icon-large

    %p
      = label_tag :topic_link, 'Ссылка или id темы:'
      = text_field_tag :topic_link
      = link_to '#', id: 'add-custom-topic', title: 'Добавить', data: {source: distributors_path} do
        %i.icon-plus.icon-large

  .field
    = f.label :document_number, t('.document_number')
    = f.text_field :document_number, required: true
    = help_icon('Введите серию и номер документа (паспорт или права), который будет предъявлен при получении заказа')
  .actions.box
    = f.submit disabled: (true if @package_form.new?)
    -#%span#errors
    -#  %i.icon-remove-sign
    - unless @package_form.new?
      или
      = link_to 'Отменить запись', distribution_package_path(@package_form.package), :method => :delete, :confirm => 'Вы уверены, что хотите отменить запись?'
    %p.small-font
      Остались вопросы? Посмотрите наш #{link_to 'скринкаст', 'http://youtu.be/whtdSajP5yE'}, загляните в #{link_to 'инструкцию', 'https://docs.google.com/document/d/1XN68WLy1LR2XZlb0vHe-VQqRCYE0yNA4xe7GekyOsWo/edit?usp=sharing'} или задайте вопрос на #{link_to 'форуме', 'http://ogromno.com/index.php?s=&showtopic=50478&view=findpost&p=2600343'}
